<div class = "container">
  <div class = "row">
    <div class = "col-md-12"style = "background-color:#cbffd3;">
      <div class = "offset-md-1">
        <div class = "row">
          <div class = "col-md-6">
            <% if @user.image? %>
              <%= image_tag asset_path(@user.image.url), :size => '100x100' %>
            <% else %>
              <%= image_tag asset_path('no_image.jpg'), :size => '100x100' %>
            <% end %>
          </div>
          <div class = "col-md-6 pt-4">
            <%= @user.name %>
          </div>
        </div>
        <div class = "row my-5">
          <div class = "col-md-12 pr-5 pb-5">
            <%= @user.introduction %>
          </div>
        </div>
        <div class = "row pb-3">
          <div class = "col-md-3">
            フォロー数：<%= link_to @user.relationships.count, following_user_path(@user.id) %>
          </div>
          <div class = "col-md-3">
            フォロワー数：<%= link_to @user.reverse_of_relationships.count, followers_user_path(@user.id) %>
          </div>
          <div class = "col-md-6">
            <% if current_user == @user %>
              <%= link_to 'ポイント残高／購入履歴', orders_path %>
            <% else %>
              <% if current_user.following?(@user) %>
                <%= form_for(current_user.relationships.find_by(follow_id: @user.id), html: { method: :delete }) do |f| %>
                  <%= hidden_field_tag :follow_id, @user.id %>
                  <%= f.submit 'フォロー外す', class: 'btn btn-primary' %>
                <% end %>
              <% else %>
                <%= form_for(current_user.relationships.build) do |f| %>
                  <%= hidden_field_tag :follow_id, @user.id %>
                  <%= f.submit 'フォローする', class: 'btn btn-primary' %>
                <% end %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class = "row mb-5">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a href="#posts" class="nav-link" data-toggle="tab">投稿</a>
      </li>
      <li class="nav-item">
        <a href="#comments" class="nav-link" data-toggle="tab">返信</a>
      </li>
      <li class="nav-item">
        <a href="#favorites" class="nav-link" data-toggle="tab">いいね</a>
      </li>
    </ul>
  </div>
  <div class = "row">
    <div class="tab-content w-100">
      <div id="posts" class="tab-pane active w-100">
        <div class = "col-md-12">
          <% @posts.each do |post| %>
            <div class = "posts w-100 mb-1" style ="background-color:#cbffd3;border:1px solid limegreen;">
              <% if post.value == 0 %>
                <%= link_to user_path(post.user), class: 'w-100' do %>
                  <div class = "row">
                    <div class = "col-md-2">
                      <% if post.user.image? %>
                        <%= image_tag asset_path(post.user.image.url), :size => '50x50' %>
                      <% else %>
                        <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                      <% end %>
                    </div>
                    <div class = "col-md-5">
                      <%= post.user.name %>
                    </div>
                  </div>
                <% end %>
                <%= link_to post_path(post.id) do %>
                  <div class = "row">
                    <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen; border-bottom:1px solid limegreen;">
                      <div class = "col-md-12 mb-3">
                        <%= post.title %>
                      </div>
                    </div>
                  </div>
                  <div class = "offset-md-1 col-md-10">
                    <div class = "row">
                      <div class = "col-md-12">
                        返信数：<%= post.post_comments.count %>
                      </div>
                      <div class = "offset-md-8">
                        <% if post.favorited_by?(current_user) %>
                          <%= link_to post_favorites_path(post), method: :delete, remote: true do %>
                            <span aria-hidden="true"></span>
                            いいね数：<%= post.favorites.count %>
                          <% end %>
                        <% else %>
                          <%= link_to post_favorites_path(post), method: :post, remote: true do %>
                            <span aria-hidden="true"></span>
                            いいね数：<%= post.favorites.count %>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <% if (current_user == post.user) || (current_user.orders.exists?(post_number: post.id)) %>
                  <%= link_to user_path(post.user), class: 'w-100' do %>
                    <div class = "row">
                      <div class = "col-md-2">
                        <% if post.user.image? %>
                          <%= image_tag asset_path(post.user.image.url), :size => '50x50' %>
                        <% else %>
                          <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                        <% end %>
                      </div>
                      <div class = "col-md-5">
                        <%= post.user.name %>
                      </div>
                      <div class = "col-md-5">
                        価値：<%= post.value %>
                      </div>
                    </div>
                  <% end %>
                  <%= link_to post_path(post.id) do %>
                    <div class = "row">
                      <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen; border-bottom:1px solid limegreen;">
                        <div class = "col-md-12 mb-3">
                          <%= post.title %>
                        </div>
                      </div>
                    </div>
                    <div class = "offset-md-1 col-md-10">
                      <div class = "row">
                        <div class = "col-md-12">
                          返信数：<%= post.post_comments.count %>
                        </div>
                        <div class = "offset-md-8">
                          <% if post.favorited_by?(current_user) %>
                            <%= link_to post_favorites_path(post), method: :delete, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= post.favorites.count %>
                            <% end %>
                          <% else %>
                            <%= link_to post_favorites_path(post), method: :post, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= post.favorites.count %>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                <% else %>
                  <%= link_to user_path(post.user), class: 'w-100' do %>
                    <div class = "row">
                      <div class = "col-md-2">
                        <% if post.user.image? %>
                          <%= image_tag asset_path(post.user.image.url), :size => '50x50' %>
                        <% else %>
                          <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                        <% end %>
                      </div>
                      <div class = "col-md-5">
                        <%= post.user.name %>
                      </div>
                      <div class = "col-md-5">
                        価値：<%= post.value %>
                      </div>
                    </div>
                  <% end %>
                  <%= link_to confilm_path(post.id) do %>
                    <div class = "row">
                      <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen; border-bottom:1px solid limegreen;">
                        <div class = "col-md-10 mb-3">
                          <%= post.title %>
                        </div>
                        購入すると本文が見れるようになります
                      </div>
                    </div>
                    <div class = "offset-md-1 col-md-10">
                      <div class = "row">
                        <div class = "col-md-12">
                          返信数：<%= post.post_comments.count %>
                        </div>
                        <div class = "offset-md-8">
                          <% if post.favorited_by?(current_user) %>
                            <%= link_to post_favorites_path(post), method: :delete, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= post.favorites.count %>
                            <% end %>
                          <% else %>
                            <%= link_to post_favorites_path(post), method: :post, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= post.favorites.count %>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              <% end %>
              <div class = "row">
                <div class = "offset-md-11">
                  <div class="dropdown">
                    <!-- 切替ボタンの設定 -->
                    <button class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                    <!-- ドロップメニューの設定 -->
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <% if current_user.id == post.user.id %>
                        <%= link_to "削除", post_path(post.id), method: :delete, "data-confirm" => "本当に消しますか？" %>
                        <%= link_to "報告", report_path(post.id), method: :patch, "data-confirm" => "本当に報告しますか？" %>
                      <% else %>
                        <%= link_to "報告", report_path(post.id), method: :patch, "data-confirm" => "本当に報告しますか？" %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <div id="comments" class="tab-pane w-100">
        <div class = "col-md-12">
          <% @post_comments.each do |post_comment| %>
            <div class = "posts w-100 mb-1" style ="background-color:#cbffd3;border:1px solid limegreen;">
              <div class = "row">
                <div class = "col-md-2">
                  <% if post_comment.user.image? %>
                    <%= image_tag asset_path(post_comment.user.image.url), :size => '50x50' %>
                  <% else %>
                    <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                  <% end %>
                </div>
                <div class = "col-md-5">
                  <%= post_comment.user.name %>
                </div>
              </div>
              <%= link_to post_path(post_comment.post) do %>
                <div class = "row">
                  <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen;">
                    <div class = "col-md-12 mb-3">
                      <%= post_comment.comment %>
                    </div>
                  </div>
                </div>
              <% end %>
              <div class = "row">
                <div class = "offset-md-11">
                  <div class="dropdown">
                    <!-- 切替ボタンの設定 -->
                    <button type="button" class="btn btn-success dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                    <!-- ドロップメニューの設定 -->
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <% if current_user == post_comment.user %>
                        <%= link_to "削除", post_post_comment_path(post_comment.post, post_comment), method: :delete, "data-confirm" => "本当に消しますか？" %>
                        <%= link_to "報告", post_comment_report_path(post_comment.post, post_comment), method: :patch, "data-confirm" => "本当に報告しますか？" %>
                      <% else %>
                        <%= link_to "報告", post_comment_report_path(post_comment.post, post_comment), method: :patch, "data-confirm" => "本当に報告しますか？" %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <div id="favorites" class="tab-pane w-100">
        <div class = "col-md-12">
          <% @favorite_posts.each do |favorite_post| %>
            <div class = "posts w-100 mb-1" style ="background-color:#cbffd3;border:1px solid limegreen;">
              <% if favorite_post.post.value == 0 %>
                <%= link_to user_path(favorite_post.post.user), class: 'w-100' do %>
                  <div class = "row">
                    <div class = "col-md-2">
                      <% if favorite_post.post.user.image? %>
                        <%= image_tag asset_path(favorite_post.post.user.image.url), :size => '50x50' %>
                      <% else %>
                        <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                      <% end %>
                    </div>
                    <div class = "col-md-5">
                      <%= favorite_post.post.user.name %>
                    </div>
                  </div>
                <% end %>
                <%= link_to post_path(favorite_post.post.id) do %>
                  <div class = "row">
                    <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen; border-bottom:1px solid limegreen;">
                      <div class = "col-md-12 mb-3">
                        <%= favorite_post.post.title %>
                      </div>
                    </div>
                  </div>
                  <div class = "offset-md-1 col-md-10">
                    <div class = "row">
                      <div class = "col-md-12">
                        返信数：<%= favorite_post.post.post_comments.count %>
                      </div>
                      <div class = "offset-md-8">
                        <% if favorite_post.post.favorited_by?(current_user) %>
                          <%= link_to post_favorites_path(favorite_post.post), method: :delete, remote: true do %>
                            <span aria-hidden="true"></span>
                            いいね数：<%= favorite_post.post.favorites.count %>
                          <% end %>
                        <% else %>
                          <%= link_to post_favorites_path(favorite_post.post), method: :post, remote: true do %>
                            <span aria-hidden="true"></span>
                            いいね数：<%= favorite_post.post.favorites.count %>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <% if (current_user == favorite_post.post.user) || (current_user.orders.exists?(post_number: favorite_post.post.id)) %>
                  <%= link_to user_path(favorite_post.post.user), class: 'w-100' do %>
                    <div class = "row">
                      <div class = "col-md-2">
                        <% if favorite_post.post.user.image? %>
                          <%= image_tag asset_path(favorite_post.post.user.image.url), :size => '50x50' %>
                        <% else %>
                          <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                        <% end %>
                      </div>
                      <div class = "col-md-5">
                        <%= favorite_post.post.user.name %>
                      </div>
                      <div class = "col-md-5">
                        価値<%= favorite_post.post.value %>
                      </div>
                    </div>
                  <% end %>
                  <%= link_to post_path(favorite_post.post.id) do %>
                    <div class = "row">
                      <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen; border-bottom:1px solid limegreen;">
                        <div class = "col-md-12 mb-3">
                          <%= favorite_post.post.title %>
                        </div>
                      </div>
                    </div>
                    <div class = "offset-md-1 col-md-10">
                      <div class = "row">
                        <div class = "col-md-12">
                          返信数：<%= favorite_post.post.post_comments.count %>
                        </div>
                        <div class = "offset-md-8">
                          <% if favorite_post.post.favorited_by?(current_user) %>
                            <%= link_to post_favorites_path(favorite_post.post), method: :delete, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= favorite_post.post.favorites.count %>
                            <% end %>
                          <% else %>
                            <%= link_to post_favorites_path(favorite_post.post), method: :post, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= favorite_post.post.favorites.count %>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                <% else %>
                  <%= link_to user_path(favorite_post.post.user), class: 'w-100' do %>
                    <div class = "row">
                      <div class = "col-md-2">
                        <% if favorite_post.post.user.image? %>
                          <%= image_tag asset_path(favorite_post.post.user.image.url), :size => '50x50' %>
                        <% else %>
                          <%= image_tag asset_path('no_image.jpg'), :size => '50x50' %>
                        <% end %>
                      </div>
                      <div class = "col-md-5">
                        <%= favorite_post.post.user.name %>
                      </div>
                      <div class = "col-md-5">
                        価値<%= favorite_post.post.value %>
                      </div>
                    </div>
                  <% end %>
                  <%= link_to confilm_path(favorite_post.post.id) do %>
                    <div class = "row">
                      <div class = "offset-md-1 col-md-10" style = "border-top:1px solid limegreen; border-bottom:1px solid limegreen;">
                        <div class = "col-md-10 mb-3">
                          <%= favorite_post.post.title %>
                        </div>
                        購入すると本文が見れるようになります
                      </div>
                    </div>
                    <div class = "offset-md-1 col-md-10">
                      <div class = "row">
                        <div class = "col-md-12">
                          返信数：<%= favorite_post.post.post_comments.count %>
                        </div>
                        <div class = "offset-md-8">
                          <% if favorite_post.post.favorited_by?(current_user) %>
                            <%= link_to post_favorites_path(favorite_post.post), method: :delete, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= favorite_post.post.favorites.count %>
                            <% end %>
                          <% else %>
                            <%= link_to post_favorites_path(favorite_post.post), method: :post, remote: true do %>
                              <span aria-hidden="true"></span>
                              いいね数：<%= favorite_post.post.favorites.count %>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              <% end %>
              <div class = "row">
                <div class = "offset-md-11">
                  <div class="dropdown">
                    <!-- 切替ボタンの設定 -->
                    <button type="button" class="btn btn-success dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                    <!-- ドロップメニューの設定 -->
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <% if current_user.id == favorite_post.post.user.id %>
                        <%= link_to "削除", post_path(favorite_post.post.id), method: :delete, "data-confirm" => "本当に消しますか？" %>
                        <%= link_to "報告", report_path(favorite_post.post.id), method: :patch, "data-confirm" => "本当に報告しますか？" %>
                      <% else %>
                        <%= link_to "報告", report_path(favorite_post.post.id), method: :patch, "data-confirm" => "本当に報告しますか？" %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>